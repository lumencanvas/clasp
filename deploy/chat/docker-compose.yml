services:
  relay:
    build: ../relay
    ports:
      - "7330:7330"
      - "7350:7350"
      - "7360:7360"
    environment:
      RUST_LOG: info
    command: ["--ws-port", "7330", "--auth-port", "7350", "--health-port", "7360",
              "--persist", "/data/state.json",
              "--app-config", "/etc/clasp/chat.json",
              "--auth-db", "/data/chat-auth.db"]
    volumes:
      - relay-data:/data
    restart: unless-stopped

  chat:
    build: ../../apps/chat
    ports:
      - "80:80"
    depends_on:
      - relay
    restart: unless-stopped

volumes:
  relay-data:
